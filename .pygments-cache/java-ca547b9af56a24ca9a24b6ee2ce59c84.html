<div class="highlight"><pre><span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">ClientBuilder</span><span class="o">.</span><span class="na">newClient</span><span class="o">();</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">future1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="s">&quot;http://example.com/customers/123&quot;</span><span class="o">)</span>
                                 <span class="o">.</span><span class="na">request</span><span class="o">()</span>
                                 <span class="o">.</span><span class="na">async</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">future2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="s">&quot;http://foobar.com/orders/456&quot;</span><span class="o">)</span>
                              <span class="o">.</span><span class="na">request</span><span class="o">()</span>
                              <span class="o">.</span><span class="na">async</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="n">Response</span> <span class="n">res1</span> <span class="o">=</span> <span class="n">future1</span><span class="o">.</span><span class="na">get</span><span class="o">();</span> <span class="c1">// block until complete</span>
<span class="k">try</span><span class="o">{</span>
   <span class="n">Customer</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">readEntity</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">){</span>
  <span class="n">t</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">()</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">res1</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> <span class="c1">//IMPORTANT</span>
<span class="o">}</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="n">Order</span> <span class="n">result2</span> <span class="o">=</span> <span class="n">future2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span> <span class="c1">// Wait 5 seconds</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">TimeoutException</span> <span class="n">timeout</span> <span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span> <span class="n">handle</span> <span class="n">exception</span> <span class="o">...</span>
<span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">){</span>
  <span class="n">Throwable</span> <span class="n">cause</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="na">getCause</span><span class="o">();</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">cause</span> <span class="k">instanceof</span> <span class="n">WebApplicationException</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">WebApplicationException</span> <span class="n">wae</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebApplicationException</span><span class="o">)</span><span class="n">cause</span><span class="o">;</span>
    <span class="n">wae</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">cause</span> <span class="k">instanceof</span> <span class="n">ResponseProcessingException</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ResponseProcessingException</span> <span class="n">rpe</span> <span class="o">=</span> <span class="o">(</span><span class="n">ResponseProcessingException</span><span class="o">)</span><span class="n">cause</span><span class="o">;</span>
    <span class="n">rpe</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">cause</span> <span class="k">instanceof</span> <span class="n">ProcessingException</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// handle processing exception</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="c1">// unknown</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>